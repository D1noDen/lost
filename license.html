<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó - Lost Account Manager</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .license-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: white;
        }
        
        .license-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .license-header h1 {
            margin: 0;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hwid-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            word-break: break-all;
        }
        
        .license-form {
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #45a049;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            margin-top: 10px;
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .status-message {
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px;
            text-align: center;
        }
        
        .status-success {
            background: rgba(76, 175, 80, 0.8);
        }
        
        .status-error {
            background: rgba(244, 67, 54, 0.8);
        }
        
        .license-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="license-container">
        <div class="license-header">
            <h1>üîê –ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó</h1>
            <p>Lost Account Manager</p>
        </div>
        
        <div class="hwid-info">
            <strong>–í–∞—à HWID:</strong><br>
            <span id="hwid-display">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
        </div>
        
        <div id="license-form" class="license-form">
            <div class="form-group">
                <label for="license-key">–ö–ª—é—á –ª—ñ—Ü–µ–Ω–∑—ñ—ó:</label>
                <input type="text" id="license-key" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à –∫–ª—é—á –ª—ñ—Ü–µ–Ω–∑—ñ—ó">
            </div>
            
            <button class="btn btn-primary" onclick="activateLicense()">
                –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é
            </button>
            
            <button class="btn btn-secondary" onclick="checkLicense()">
                –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –ª—ñ—Ü–µ–Ω–∑—ñ—é
            </button>
        </div>
        
        <div id="license-info" class="license-info hidden">
            <h3>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ª—ñ—Ü–µ–Ω–∑—ñ—é</h3>
            <div id="license-details"></div>
            <button class="btn btn-secondary" onclick="removeLicense()">
                –í–∏–¥–∞–ª–∏—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é
            </button>
        </div>
        
        <div id="status-message" class="status-message hidden"></div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="window.close()">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è HWID –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const hwid = await ipcRenderer.invoke('get-hwid');
                document.getElementById('hwid-display').textContent = hwid;
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ—Ç–æ—á–Ω—É –ª—ñ—Ü–µ–Ω–∑—ñ—é
                await checkLicense();
            } catch (error) {
                showMessage('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è HWID: ' + error.message, 'error');
            }
        });
        
        // –§—É–Ω–∫—Ü—ñ—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –ª—ñ—Ü–µ–Ω–∑—ñ—ó
        async function activateLicense() {
            const licenseKey = document.getElementById('license-key').value.trim();
            
            if (!licenseKey) {
                showMessage('–í–≤–µ–¥—ñ—Ç—å –∫–ª—é—á –ª—ñ—Ü–µ–Ω–∑—ñ—ó', 'error');
                return;
            }
            
            try {
                showMessage('–ê–∫—Ç–∏–≤–∞—Ü—ñ—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó...', 'info');
                const result = await ipcRenderer.invoke('activate-license', licenseKey);
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    document.getElementById('license-key').value = '';
                    setTimeout(() => checkLicense(), 1000);
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('–ü–æ–º–∏–ª–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó: ' + error.message, 'error');
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—ó
        async function checkLicense() {
            try {
                const result = await ipcRenderer.invoke('check-license');
                
                if (result.valid) {
                    showLicenseInfo(result.license);
                } else {
                    hideLicenseInfo();
                    if (result.error !== '–õ—ñ—Ü–µ–Ω–∑—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞') {
                        showMessage('–°—Ç–∞—Ç—É—Å –ª—ñ—Ü–µ–Ω–∑—ñ—ó: ' + result.error, 'error');
                    }
                }
            } catch (error) {
                showMessage('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—ó: ' + error.message, 'error');
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó
        async function removeLicense() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –ª—ñ—Ü–µ–Ω–∑—ñ—é?')) {
                try {
                    const result = await ipcRenderer.invoke('remove-license');
                    if (result) {
                        showMessage('–õ—ñ—Ü–µ–Ω–∑—ñ—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞', 'success');
                        hideLicenseInfo();
                    } else {
                        showMessage('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó', 'error');
                    }
                } catch (error) {
                    showMessage('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—ó: ' + error.message, 'error');
                }
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ª—ñ—Ü–µ–Ω–∑—ñ—é
        function showLicenseInfo(license) {
            const infoDiv = document.getElementById('license-info');
            const detailsDiv = document.getElementById('license-details');
            
            let html = `
                <p><strong>–ö–ª—é—á:</strong> ${license.licenseKey}</p>
                <p><strong>–¢–∏–ø:</strong> ${license.type || 'N/A'}</p>
                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${license.status}</p>
                <p><strong>HWID:</strong> ${license.hwid || '–ù–µ –ø—Ä–∏–≤\'—è–∑–∞–Ω–∏–π'}</p>
                <p><strong>–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ:</strong> ${license.activatedAt ? new Date(license.activatedAt).toLocaleString() : 'N/A'}</p>
            `;
            
            if (license.expiryDate) {
                html += `<p><strong>–¢–µ—Ä–º—ñ–Ω –¥—ñ—ó –¥–æ:</strong> ${new Date(license.expiryDate).toLocaleString()}</p>`;
            } else {
                html += `<p><strong>–¢–µ—Ä–º—ñ–Ω –¥—ñ—ó:</strong> –ë–µ–∑—Å—Ç—Ä–æ–∫–æ–≤–æ</p>`;
            }
            
            detailsDiv.innerHTML = html;
            infoDiv.classList.remove('hidden');
        }
        
        // –°—Ö–æ–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ª—ñ—Ü–µ–Ω–∑—ñ—é
        function hideLicenseInfo() {
            document.getElementById('license-info').classList.add('hidden');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        function showMessage(message, type) {
            const messageDiv = document.getElementById('status-message');
            messageDiv.textContent = message;
            messageDiv.className = 'status-message';
            
            if (type === 'success') {
                messageDiv.classList.add('status-success');
            } else if (type === 'error') {
                messageDiv.classList.add('status-error');
            }
            
            messageDiv.classList.remove('hidden');
            
            if (type !== 'info') {
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 5000);
            }
        }
        
        // –û–±—Ä–æ–±–∫–∞ Enter –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó
        document.getElementById('license-key').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                activateLicense();
            }
        });
    </script>
</body>
</html>
